<mat-drawer-container autosize>
    <form class="container vh-100 d-flex flex-column pt-4 pb-2"  [formGroup]="form" (ngSubmit)="handleSend()">
        <div class="header-settings d-flex justify-content-between">
            <mat-form-field class="col-4 col-lg-2">
                <mat-label>Model</mat-label>
                <mat-select formControlName="model">
                    @for (model of models; track model) {
                        <mat-option [value]="model">{{model.viewValue}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>

            <div class="header-settings__controls d-flex align-items-center justify-content-sm-between col-6 col-lg-4">
                <mat-form-field class="w-100 me-5   ">
                    <mat-label>API KEY</mat-label>
                    <input matInput  formControlName="key" type="password" name="key" autocomplete="key">
                </mat-form-field>
                <button (click)="drawer.toggle()">
                    <mat-icon>settings</mat-icon>
                </button>
            </div>
        </div>

        <div class="h-75 d-inline-block  mb-4 border ps-3 pe-3 pt-2 pb-2 overflow-auto">
                @for (message of messages; track message) {
                    <div #messageRef class="message-wrapper d-flex">
                        <div class="d-flex">
                            <div class="message__owner--icon d-flex justify-content-center align-items-center me-2 " [class.user]="message.role === ROLE.user">
                                @if (message.role === ROLE.user) {
                                    <mat-icon class="d-flex" svgIcon="user"></mat-icon>
                                } @else {
                                    <mat-icon class="d-flex" svgIcon="chat-gpt"></mat-icon>
                                }
                            </div>
                        </div>
                        <div class="message pb-4">
                              <span class="message__owner d-flex text-white fw-bold text-capitalize">{{message.role}}</span>
                             <p class="message__body">{{message.content}}</p>
                        </div>
                    </div>
                }
        </div>
        <div class="row h-25 d-flex justify-content-center">
            <mat-form-field class="w-100 h-100 example-full-width">
                <textarea class="w-100 h-100 example-full-width"
                          placeholder="Question"
                          formControlName="question"
                          [cdkTextareaAutosize]="true"
                          matInput></textarea>
            </mat-form-field>
        </div>

        <button type="submit" class="col-1 ms-auto" mat-raised-button color="primary" [disabled]="isLoading()">
            @if (isLoading()) {
                <mat-spinner [diameter]="25"></mat-spinner>
            } @else {
                <span>
                   Send
                </span>
            }
        </button>
    </form>

    <mat-drawer #drawer class="settings-menu h-100 w-25 p-4" mode="side" [position]="'end'">
        <div class="settings-menu__head justify-content-sm-between d-flex">


            <h5>Advanced settings</h5>
            <button>
                <mat-icon (click)="drawer.toggle()">close</mat-icon>
            </button>
        </div>

    </mat-drawer>
</mat-drawer-container>
