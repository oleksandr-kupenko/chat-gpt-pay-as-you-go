<mat-drawer-container autosize>
  <form class="container vh-100 d-flex flex-column pt-4 pb-2" [formGroup]="chatForm" (ngSubmit)="handleSend()">
    <div class="header-settings d-flex justify-content-between">
      <mat-form-field class="col-4 col-lg-2">
        <mat-label>Model</mat-label>
        <mat-select formControlName="model">
          @for (model of models; track model) {
            <mat-option [value]="model">{{ model.viewValue }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <div class="header-settings__controls d-flex align-items-center justify-content-sm-between">
        <button (click)="drawer.toggle()">
          <mat-icon>settings</mat-icon>
        </button>
      </div>
    </div>

    <div class="h-75 d-inline-block mb-4 border ps-3 pe-3 pt-2 pb-2 overflow-auto">
      @for (message of messages; track message) {
        <div #messageRef class="message-wrapper d-flex">
          <div class="d-flex">
            <div
              class="message__owner--icon d-flex justify-content-center align-items-center me-2"
              [class.user]="message.role === ROLE.user"
            >
              @if (message.role === ROLE.user) {
                <mat-icon class="d-flex" svgIcon="user"></mat-icon>
              } @else {
                <mat-icon class="d-flex" svgIcon="chat-gpt"></mat-icon>
              }
            </div>
          </div>
          <div class="message pb-4">
            <span class="message__owner d-flex text-white fw-bold text-capitalize">{{ message.role }}</span>
            <p class="message__body">{{ message.content }}</p>
          </div>
        </div>
      }
    </div>
    <div class="row h-25 d-flex justify-content-center">
      <mat-form-field class="main-form w-100 h-100">
        <textarea
          class="w-100 h-100 example-full-width"
          placeholder="Question"
          formControlName="question"
          [cdkTextareaAutosize]="true"
          matInput
        ></textarea>
      </mat-form-field>
    </div>

    <button type="submit" class="col-1 ms-auto" mat-raised-button color="primary" [disabled]="isLoading()">
      @if (isLoading()) {
        <mat-spinner [diameter]="25"></mat-spinner>
      } @else {
        <span> Send </span>
      }
    </button>
  </form>

  <mat-drawer
    #drawer
    class="settings-menu h-100 d-flex flex-column col-12 col-md-6 col-lg-5 col-xl-4 p-4"
    mode="side"
    [position]="'end'"
  >
    <div class="settings-menu__head justify-content-sm-between d-flex">
      <button class="ms-auto">
        <mat-icon (click)="drawer.toggle()">close</mat-icon>
      </button>
    </div>
    <form
      class="settings-form w-100 mt-3 d-flex flex-column"
      [formGroup]="settingsForm"
      (ngSubmit)="handleSaveSettings()"
    >
      <mat-form-field class="w-100">
        <mat-label>API KEY</mat-label>
        <input
          matInput
          formControlName="key"
          type="password"
          name="key"
          [autocomplete]="null"
          (input)="handleKeyInput()"
        />
      </mat-form-field>
      <div class="settings-form__controls d-flex justify-content-end">
        <button
          class="me-2"
          type="submit"
          mat-raised-button
          color="primary"
          [disabled]="isLoading() || !settingsForm.touched || !settingsForm.value.key"
        >
          Save
        </button>
        <button
          type="submit"
          mat-raised-button
          color="primary"
          [disabled]="isLoading() || !currentKey()"
          (click)="handleDeleteKey()"
        >
          Delete
        </button>
      </div>
    </form>
    <h5 class="mt-3">Advanced settings</h5>
  </mat-drawer>
</mat-drawer-container>
