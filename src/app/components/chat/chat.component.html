<form class="container vh-100 d-flex flex-column pt-4 pb-2" [formGroup]="chatForm" (ngSubmit)="handleSend()">
  <div class="header-settings d-flex justify-content-between">
    <mat-form-field class="col-4 col-lg-2">
      <mat-label>Model</mat-label>
      <mat-select formControlName="model">
        @for (model of models; track model) {
          <mat-option [value]="model">{{ model.viewValue }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <div class="header-settings__controls d-flex align-items-center justify-content-sm-between">
      <app-settings-btn></app-settings-btn>
    </div>
  </div>

  <div class="h-75 d-inline-block mb-4 border ps-3 pe-3 pt-2 pb-2 overflow-auto">
    @for (message of messages; track message) {
      <div #messageRef class="message-wrapper d-flex">
        <div class="d-flex">
          <div
            class="message__owner--icon d-flex justify-content-center align-items-center me-2"
            [class.user]="message.role === ROLE.user"
          >
            @if (message.role === ROLE.user) {
              <mat-icon class="d-flex" svgIcon="user"></mat-icon>
            } @else {
              <mat-icon class="d-flex" svgIcon="chat-gpt"></mat-icon>
            }
          </div>
        </div>
        <div class="message pb-4">
          <span class="message__owner d-flex text-white fw-bold text-capitalize">{{ message.role }}</span>
          <p class="message__body">{{ message.content }}</p>
        </div>
      </div>
    }
  </div>
  <div class="row h-25 d-flex justify-content-center">
    <mat-form-field class="main-form w-100 h-100">
      <textarea
        class="w-100 h-100 example-full-width"
        placeholder="Question"
        formControlName="question"
        [cdkTextareaAutosize]="true"
        matInput
      ></textarea>
    </mat-form-field>
  </div>
  <button
    type="submit"
    class="col-1 ms-auto"
    mat-raised-button
    color="primary"
    [disabled]="isLoading() || !chatForm.value.question"
  >
    @if (isLoading()) {
      <mat-spinner [diameter]="25"></mat-spinner>
    } @else {
      <span>Send</span>
    }
  </button>
</form>
